<?php
// Obtener IP del cliente
$ip = $_SERVER['REMOTE_ADDR'] ?? 'No disponible';

// Intentar obtener la MAC desde la tabla ARP o ip neigh
$mac = "No disponible";

// Probar con 'ip neigh' (moderno)
$arp = shell_exec("ip neigh show " . escapeshellarg($ip));
if (preg_match('/..:..:..:..:..:../', $arp, $matches)) {
    $mac = $matches[0];
} else {
    // Si no funciona, probar con 'arp -n' (más clásico)
    $arp = shell_exec("arp -n " . escapeshellarg($ip));
    if (preg_match('/..:..:..:..:..:../', $arp, $matches)) {
        $mac = $matches[0];
    }
}
?>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" href="/images/splash.jpg" type="image/x-icon">
  <link rel="stylesheet" type="text/css" href="/splash.css">

  <title>Invitados Hotspot WIFI - Estado</title>
</head>
<body>
  <div class="card">
    <img src="/images/splash.jpg" alt="Logo del Hotspot" class="logo">

    <h2 class="title">INVITADOS Hotspot WIFI</h2>

    <hr>
    <p class="welcome">
      ✅ Ya estás autenticado y tienes acceso a Internet.
    </p>
    <hr>

    <p class="info">
      Ahora puedes usar tu navegador, correo electrónico y otras aplicaciones de red normalmente.
    </p>

    <!-- Datos del dispositivo -->
    <div class="device-info">
      <p><b>Dirección IP:</b> <?= htmlspecialchars($ip) ?></p>
      <p><b>Dirección MAC:</b> <?= htmlspecialchars($mac) ?></p>
    </div>

    <hr>
    <p class="footer">
      &copy; 2025 Jaime Galvez Martinez · 
      <a href="mailto:jaime.galvez@linuxmail.org">jaime.galvez@linuxmail.org</a><br>
      Este software se publica bajo licencia GNU GPL.
    </p>
  </div>
</body>
</html>
